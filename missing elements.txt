# Missing Elements - Updated

## FIXED (Session 4):
# - Ecuador: added full coat of arms (Chimborazo, Guayas river, steamship, caduceus, zodiac sun, condor, laurel, palm, fasces)
# - Paraguay: added verso (reverse) with lion, phrygian_cap, "Paz y Justicia" banner
# - Bolivia: added full coat of arms (Cerro Rico, chapel, llama, wheat, 10 stars, condor, laurel/olive wreath, flags, cannon, rifles, axe, liberty cap)
# - Nicaragua: added rainbow, phrygian_cap, 5 mountains, 2 seas, text "REPUBLICA DE NICARAGUA" and "AMERICA CENTRAL"
# - Singapore: removed stars_circle (stars form pentagon, not circle)
# - Cabo Verde: changed stars_circle to ellipse arrangement
# - Malta: removed gold color and dragon element (George Cross detail only)
# - Afghanistan: removed gold color (emblem is white)
# - Samoa & Papua New Guinea: added note that southern_cross is constellation, not heraldic cross
# - Added musical_instruments category (drum, trumpet, horn, harp)
# - Added landscape category (mountain, river, island, hill, lake)
# - Added llama, vicu√±a to mammals
# - Added chapel to buildings
# - Added rainbow, fasces, caduceus, cornucopia, scroll to other_symbols
# - Added oak to leaves_flowers
# - Costa Rica: added volcanoes, ships, rising sun, 7 stars, coffee beans, text
# - Dominican Republic: added shield, bible, cross, laurel, palm, spears, flags, motto "Dios, Patria, Libertad"
# - El Salvador: added triangle, 5 volcanoes, sea, phrygian_cap, sun, rainbow, 5 flags, 5 spears, laurel, motto, date, encircling text
# - Guatemala: added scroll with independence date, updated rifle/sword details
# - Mexico: added lake, oak wreath, ribbon

## FIXED (Session 3):
# - Peru flag: now using state flag with coat of arms (Wikipedia source)

## FIXED (Session 2):
# - Peru: added full coat of arms (vicu√±a, cinchona tree, cornucopia, laurel, palm, coins)
# - Uzbekistan: removed incorrect fimbriation
# - Haiti: added phrygian_cap (bonnet phrygien), added motto translation
# - Added phrygian_cap to taxonomy under People
# - Brazil: fixed motto with translation "Order and Progress"
# - Andorra: added motto translation "United Virtue is Stronger"
# - Belize: added motto translation "Under the Shade I Flourish"
# - Mobile filters: new quick filters (3 vertical, 3 horizontal, other bands, colors, animals, weapons, flora, motto)
# - Mobile filters: greyed out components hidden, filters apply instantly

## FIXED (Session 1):
# - Malta: added horse, human_figure (saint_george), sword, motto "FOR GALLANTRY", dragon
# - Brunei: added hand, people (supporters), wings, umbrella, motto
# - Mongolia: added circle, triangle, rectangle, yin-yang (taijitu), crescent, flame
# - Vanuatu: added namale_leaves
# - Kosovo: added as new country with blue, 6 white stars in arc, golden map
# - Spain: added lion, tower (castle), motto "PLVS VLTRA", pomegranate (granada), fleur_de_lys
# - Added leaves category to taxonomy (maple, namale)
# - Search now works in French and supports keyword search (elements, colors)

## ALL COMPLETED

## FIXED (Session 5):
# - Pan-color buttons (Panslave, Panafricain, Panarabe) moved to "R√©gions/Cultures" section
# - Removed "Asie du Sud-Est" and "Moyen-Orient" buttons and their algorithms
# - Removed South Sudan, Saudi Arabia, Lebanon from Pan-Arab countries list
# - Renamed "Scandinavia" to "Pays Nordiques" (Nordic Countries)
# - Added "Communist" button (red circle with yellow 5-pointed star) with: China, North Korea, Cuba, Laos, Vietnam
# - All "R√©gions/Cultures" buttons are now exclusive (only one can be selected at a time)
# - Mobile Light menu now matches desktop: no category titles, just buttons with thin separators
# - Updated continent emojis: Africa ü¶Å, Europe üêÆ, N. America üóΩ, S. America üóø, Asia üê≤, Oceania ü¶ò

## ALL COMPLETED

## FIXED (Session 6):
# - Continent buttons now mutually exclusive (radio button style) - desktop & mobile
# - Mobile continent labels changed to: AF, EU, N-A, S-A, AS, OC
# - Diagonal division now includes: Seychelles, DRC, Saint Kitts and Nevis, Brunei, Marshall Islands, Trinidad and Tobago, Namibia, Tanzania, Bosnia and Herzegovina, Bhutan, Republic of the Congo, Philippines
# - Search bar now resets all filters when user starts typing
# - Color selector disabled/hidden for Diagonal division, Nordic cross, and Canton layouts
# - STRICT band color matching by position implemented for 2-band and 3-band layouts
# - "Any color" (null) can be set per individual band - only checks positions with specified colors
# - Symbol / Coat of Arms toggle added to pattern selector, works in combination with band colors
# - All changes applied to both desktop (LightFiltersSidebar) and mobile (TopFiltersMobile)

## ALL COMPLETED

## FIXED (Session 7):
# - Added band_colors field to JSON for flags with A/B/A patterns: Canada, Peru, Mongolia, Austria, Latvia, Spain
# - Syria band_colors corrected to ["green", "white", "black"] (green on top, not red!)
# - Pakistan band_colors added: ["white", "green"] (white hoist, green fly) - was incorrectly showing for "right band = white"
# - Updated extractBandColors() to prioritize explicit band_colors field
# - Added fallback: 2-color tribands automatically assume A/B/A pattern
# - Removed gold, maroon, light_blue from band color palette
# - Improved band selection UI: color palette appears to the RIGHT of band preview (no truncation)
# - "Any color" option (?) now FIRST in palette, clearly visible with striped pattern
# - Smaller color circles (w-5 h-5) for compact horizontal layout
# - Strict position matching: only matches if color at position matches
# - Verified all 52 biband/triband flags - only Pakistan had wrong band order

## ALL COMPLETED

# ARCHIVE - Previous issue: 
# Color-band filtering ‚Äî issues to fix & required behaviors

(All changes must also apply on mobile.)

1. Incorrect flag results to fix (examples)

These examples show errors in the current band-by-band color comparison logic:

Syria must not appear when the upper band = red.

Remove the following colors from the available palette: ‚Äúor‚Äù, ‚Äúmarron‚Äù, and ‚Äúbleu ciel‚Äù.

Mongolia must not appear under:

red / any / yellow

Peru must not appear under:

red / any / green

Canada, Mongolia, and Peru must appear under:

red / any / red

These examples show that the current comparison logic is not detecting certain color patterns correctly.

2. Review & fix the band comparison method

The current logic comparing the 1st, 2nd, 3rd band colors seems flawed.

Required update:

Re-evaluate the comparison algorithm and the JSON structure used for color data.

If needed, separate color-band data from symbol / coat-of-arms metadata, because mixing them may create false positives in band-matching.

Before rewriting everything, try to detect patterns:

Is the problem limited to the examples above?

Or is the logic failing whenever a flag contains a symbol, split band, or non-standard layout?

Update the algorithm to reliably match colors strictly by band position unless the band is set to "any-color".

3. Color assignment UI ‚Äî improved behavior

Improve the interaction when selecting colors for each band:

Desktop:

Clicking on a band opens a small tooltip palette.

Clicking a color in the palette sets the band color.

The palette must include ‚Äúany-color‚Äù.

Selecting ‚Äúany-color‚Äù turns the band into a greyed / slashed state indicating that any color is allowed.

Mobile:

On mobile, selection works in two taps, similar to selecting a skin-tone for emojis:

First tap on the band ‚Üí open the palette.

Second tap ‚Üí select the color (including ‚Äúany-color‚Äù).

4. ‚ÄúAny-color‚Äù behavior

‚ÄúAny-color‚Äù must be selectable on any band.

When a band is set to ‚Äúany-color‚Äù, the filter should not restrict that band at all.

Other bands must still be matched strictly.

The strict matching logic (fixed colors OR any-color) must remain consistent across:

2-band horizontal

3-band horizontal

2-band vertical

3-band vertical

5. Acceptance criteria

Syria, Mongolia, Peru, and Canada behave as required in the given examples.

Removed colors no longer appear in the palette.

‚ÄúAny-color‚Äù works per band and interacts correctly with strict matching.

Updated comparison logic correctly filters flags in all band configurations.

UI interactions behave correctly on desktop and mobile.

JSON structure and comparison logic are adjusted if necessary to fix structural problems.

## FIXED (Session 8):
# - Sorting tool: now shows ascending/descending arrows (‚Üë/‚Üì) next to sort options
# - Sort by name: now properly uses French translation for French mode (Allemagne sorts alphabetically by "A")
# - Removed sort by stars and colors
# - Added sort by population and area (ascending and descending)
# - Added "Show Names" toggle button near sorting tool - displays country name below flag like hover
# - Continent labels changed from emojis to text abbreviations:
#   - English: EU, N.A, S.A, AS, AF, OC
#   - French: EU, A.N, A.S, AS, AF, OC
# - Removed "Pays Nordique" (Nordic Countries) button from Regions/Cultures
# - Removed Caribbean button from Regions/Cultures
# - Central America now shows as "C.A" (English) / "A.C" (French) instead of palm tree emoji
# - Color filter mode: 3 exclusive buttons with tooltips:
#   - OR/OU: "Show flags with ANY of the selected colors (union)"
#   - AND/ET: "Show flags with ONLY these colors (exact match)"
#   - NOT/NON: "Exclude flags with ANY of these colors"
# - Filter notification: when clicking a filter, full name appears in center of screen for 1 second
# - Mobile toggle button moved to BOTTOM of menu with +/- characters
# - Flag image in CountryInfoPanel modal enlarged (now takes ~85% viewport width, max 680px)

## FIXED (Session 9):
# - Removed "Masquer/Afficher" (Hide/Show) toggle button from desktop sidebar
# - Mobile toggle button: smaller (w-6 h-6), blends into bottom border, centered
# - Mobile toggle button: red for collapse (-), green for expand (+)
# - Light/Advanced menu tabs remain at TOP on mobile (not moved to bottom)
# - Color filter mode: re-added üîì üîí üö´ emojis with hover tooltips:
#   - üîì OR/OU: "Flags containing these colors (among others)"
#   - üîí AND/ET: "Flags containing ONLY these colors"
#   - üö´ NOT/NON: "Flags NOT containing these colors"
# - Filter notification: now universal for ALL filters (colors, shapes, animals, etc.)
# - "Noms/Names" label always visible next to eye icon (mobile & desktop)
# - Continent buttons now mutually exclusive WITH Region/Culture buttons
# - Number formatting improved:
#   - Billions: X.XX Mrd (FR) / X.XX B (EN)
#   - Millions: X.XX M
#   - Regular: space as thousand separator

## FIXED (Session 10):
# - Eye icon logic INVERTED: EyeOff = names visible, Eye = names hidden
# - Replaced chevrons with proper up/down arrows in sort selector
# - Desktop flag image in CountryInfoPanel: reduced to 300px max height
# - Added Flag/Coat of Arms toggle buttons in CountryInfoPanel:
#   - Two buttons appear when coat of arms is available
#   - Flag (default), Armoiries/Coat of Arms
#   - Smooth animation when switching
# - Coat of arms images loaded from Wikimedia Commons:
#   - Uses API coat of arms URL if available
#   - Falls back to generated Wikimedia URL pattern
#   - Special cases for Malta (George Cross), USA, UK, Russia, etc.
#   - Error handling when coat of arms not available

## FIXED (Session 11):
# - Updated coat of arms URLs for:
#   - Afghanistan: National_Emblem_of_Afghanistan_001.svg
#   - Spain: Coat_of_Arms_of_Spain_(corrections_of_heraldist_requests).svg
#   - Iran: Emblem_of_Iran_(red).svg
#   - Peru: Escudo_nacional_del_Peru.svg
#   - Fiji: Arms_of_Fiji.svg
#   - Malta: George_Cross_of_Malta_737x737.svg
#   - Added 20+ more verified URLs (Mexico, Haiti, Andorra, Ecuador, Bolivia, etc.)
# - Population/Area sorting NOW WORKS:
#   - Created countryDataStore.ts to fetch data from RestCountries API
#   - Data source: https://restcountries.com/v3.1/all (population & area fields)
#   - Data is fetched once at app startup and cached
#   - Sorting uses this cached data (not hardcoded)
#   - Handles country name mapping between our names and API names
# - FIXED: Coat of arms now PRIORITIZES our verified URLs over API URLs
# - FIXED: Flag/Coat of Arms toggle buttons moved BELOW the flag image
# - FIXED: Sao Tome and Principe name mapping for correct sorting
# - FIXED: PWA caching issue - app now always updates on mobile/PC:
#   - Service worker uses NETWORK-FIRST strategy for app files
#   - Auto-update detection with immediate reload
#   - Added _headers file for proper cache control
#   - SW version timestamp for cache busting
#   - updateViaCache: 'none' ensures fresh SW on each check

## FIXED (Session 12):
# - Added special coat of arms URLs for Chad, Portugal, Serbia:
#   - Chad: https://upload.wikimedia.org/wikipedia/commons/c/c1/Coat_of_arms_of_Chad.svg
#   - Portugal: https://upload.wikimedia.org/wikipedia/commons/9/95/Coat_of_arms_of_Portugal_(lesser).svg
#   - Serbia: https://upload.wikimedia.org/wikipedia/commons/0/0f/Coat_of_arms_of_Serbia_small.svg
# - Added prev/next navigation arrows in CountryInfoPanel:
#   - Left/right arrows on each side of Flag/Coat of Arms buttons
#   - Preserves displayMode (flag/coat) when navigating
#   - Disabled state when at start/end of list
#   - Works within current filtered list
# - Optimized flag image loading:
#   - IntersectionObserver for true lazy loading (only loads when visible)
#   - 100px rootMargin for preloading slightly before viewport
#   - Loading skeleton/placeholder while image loads
#   - Memoized FlagCard component to prevent unnecessary re-renders
#   - Reduced animation delays for faster perceived performance
#   - Flag images cached separately from app files (cache-first for flagcdn.com)
#   - PWA still updates correctly (network-first for app files)

## FIXED (Session 13):
# - Added special coat of arms URLs for:
#   - Cabo Verde, DR Congo, Eswatini, France, Gabon, Guinea-Bissau
#   - Hungary, Malaysia, Timor-Leste, Trinidad and Tobago
# - Fixed hasCoatOfArms check to include countries with special URLs
#   - Now Timor-Leste and other special countries show the button
# - Added light background for India and Pakistan coat of arms
#   - Dark emblems now visible on light grey background

## FIXED (Session 14):
# - Fixed Trinidad and Tobago coat of arms URL (2025 version)
# - Continent buttons no longer greyed out when one is selected
#   - Now behave like Region/Culture buttons (exclusive but all visible)
# - Added zoom/magnifying glass feature for flag and coat of arms:
#   - Loupe icon on bottom-right of image
#   - PC: Click to open full-screen view, click to close, drag to pan
#   - Mobile: Press and hold to view, drag to pan, release to close

## FIXED (Session 15):
# - Fixed mobile zoom using proper Touch Events API:
#   - Reference: https://developer.mozilla.org/en-US/docs/Web/API/Touch_events
#   - Tap on loupe ‚Üí opens zoom view
#   - In zoom view: tap to close, drag to pan (with proper threshold detection)
#   - Fixed touch-none CSS to prevent browser gestures
#   - Close button visible on mobile too
# - Improved mobile search bar UX:
#   - Modern slide-down overlay design
#   - Back arrow (‚Üê) to close
#   - Backdrop tap to close
#   - "Cancel" button to clear and close
#   - Clear (X) button inside input
#   - Auto-focus on open
#   - Search icon highlights when search has text

## ALL COMPLETED